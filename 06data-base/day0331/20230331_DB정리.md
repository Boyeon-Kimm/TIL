# 2023.03.31

# DB(Database) 복습

## DBMS(Database Management System)

### 데이터베이스 관리 프로그램

- 데이터 베이스 조작 인터페이스 제공
- 효율적인 데이터 관리 기능 제공
- 데이터베이스 구축 기능 제공
- 데이터 복구, 사용자 권한 부여, 유지보수 기능 제공

<br>
<br>

## SQL(Structed Query Language)

### SQL

- 관계형 데이터 베이스에서 데이터 조작과 데이터 정의를 위해 사용하는 언어
    - 데이터 조회 : `SELECT`
    - 데이터 삽입 : `INSERT`
    - 데이터 삭제 : `DELETE`
    - 데이터 수정 : `UPDATE`
    - DB Object 생성 및 변경, 삭제 : `CREATE` `DROP` `ALTER`
    - DB 사용자 생성 및 삭제, 권한 제어
- 표준 SQL은 모든 DBMS에서 사용가능

<br>

<br>

### DML(Data Manipulation Language) : 데이터 조작 언어

- 데이터 베이스에서 데이터를 조작하거나 조회할 때 사용
- 테이블의 레코드를 CRUD(Create, Read, Update, Delete)

<br>

<br>

### DDL (Data Definition Language) : 데이터 정의 언어

- 데이터 베이스 객체(table, view, user, index 등)의 구조를 정의

<br>

<br>

### DCL(Data Control Language) : 데이터 제어 언어

- Database, Table 접근 권한이나 CRUD권한 정의
- 특정 사용자에게 테이블의 검색 권한 부여/ 금지

<br>

<br>

### TCL(Transaction Control Language) : 트랜잭션 제어 언어

- 트랜잭션 단위로 실행한 명령문을 적용하거나 취소
    - 적용 : `COMMIT`
    - 취소 : `ROLLBACK`

<br>

<br>

<br>

## DDL(Data Definition Language)

### 데이터베이스 생성하기

```sql
CREATE DATABASE databasename;
```

- CREATE DATABASE 명령문은 새 데이터 베이스를 생성하는데 사용된다
- 데이터 베이스는 여러 테이블을 포함하고 있다
- 데이터 베이스 생성 시 관리자 권한으로 생성해야 한다
- 

<aside>
💡 데이터베이스 생성 후, SHOW DATABASE; 를 이용해서 데이터 베이스 목록을 확인할 수 있다

</aside>

<br>

<br>

### 데이터베이스 삭제

- 데이터 베이스의 모든 테이블을 삭제하고 데이터베이스를 삭제
- 삭제 시, DROP DATABASE 권한 필요
- DROP SCHEMA는 DROP DATABASE와 동의어
- IF EXISTS는 데이터베이스가 없을 시 발생할 수 있는 에러를 방지

```sql
DROP {DATABASE | SCHEMA} [IF EXISTS] db_name
```

<br>

<br>

### 데이터베이스 사용

- 데이터베이스가 있는 경우(접근 권한이 있는 경우), USE 명령어를 이용하여 사용한다

```sql
USE databasename;
```

<br>

<br>

## 테이블(Table) 생성하기

### 테이블 스키마

- 스키마(Schema) : 테이블에 저장될 데이터의 구조와 형식
    - ex ) 교육생의 정보를 저장하기 위한 테이블

```sql
-- 테이블 생성
CREATE TABLE ssafy_user
	user_num INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	user_id VARCHAR(20) NOT NULL,
	user_name VARCHAR(20) NOT NULL,
	user_password VARCHAR(20) NOT NULL,
	user_email VARCHAR(30),
	signup_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

<br>

<br>

### 테이블 스키마 확인하기

- `DESCRIBE` 또는 `DESC` 명령어를 이용하여 생성된 테이블 스키마 확인

```sql
{DESCRIBE | DESC}table_name;

-- 테이블 정보 확인
DESC ssafy_user;
```

<br>

<br>

<br>

## DML(Insert, Update, Delete)

### INSERT문

- 생성 시 작성한 모든 컬럼에 입력 값이 주어지면 컬럼 이름 생략 가능
- 컬럼 이름과 입력 값의 순서가 일치하도록 작성
    - (`NULL` , `DEFAULT` , `AUTO INCREMENT` 설정 필드 생략 가능)

```sql
INSERT INTO table_name
	VALUES (1, 2, 3, 4, .... N);
```

<br>

<br>

### UPDATE문

- 기존 레코드를 수정한다
- WHERE절을 이용하여 하나의 레코드 또는 다수의 레코드를 한 번에 수정할 수 있따

```sql
UPDATE table_name
	 SET col_name = value[,col_name2 = value2, ...]
[WHERE where_condition];
```

<aside>
💡 WHERE 절을 생략하면 테이블의 모든 행이 수정된다. 따라서 어떠한 레코드들을 수정할지 결정하는 정확한 조건문을 작성하는 연습이 필수적이다

</aside>

<br>
<br>

### DELETE문

- 기존 레코드를 삭제한다
- WHERE절을 이용해 하나의 레코드 또는 다수의 레코드를 한 번에 삭제할 수 있다.

```sql
DELETE FROM tbl_name
[WHERE where_condition];

-- user_num가 4인 레코드를 삭제
DELETE FROM ssafy_user
WHERE user_num = 4;
```

<br>

<br>

### SELECT문

- 테이블에서 레코드를 조회하기 위해 사용
- 조회 시 컬럼 이름이나 표현식을 조회할 수 있고 별칭(alias) 사용이 가능하다
- `*` 는 모든 속성을 조회한다
- WHERE 조건식을 이용하여 원하는 레코드를 조회할 수 있따

```sql
SELECT [DISTINCT] {* | column_name | expressions [alias]}
FROM table_references
[WHERE where_condition]
[GROUP BY {col_name | expr | position},]
[HAVING where_condition]
[ORDER BY {col_name | expr | position}[ASC | DESC]]
[LIMIT {[offset,]row_count | row_count OFFSET offset}]
```

<br>

<br>

<br>

## 트랜잭션(Transaction)

### 트랜잭션

- 커밋(Commit) 하거나 롤백(Rollback) 할 수 있는 가장 작은 작업 단위
- 커밋(Commit) : 트랜잭션을 종료하여 변경사항에 대해서 영구적으로 저장하는 SQL
- 롤백(Rollback) : 트랜잭션에 의해 수행된 모든 변경사항을 실행 취소하는 SQL

<aside>
💡 MySQL에서는 기본적으로 세션이 시작하면 autocommit 설정 상태이다. 그러므로 MySQL은 각 SQL 문장이 오류를 반환하지 않으면 commit을 수행한다

</aside>

<br>

<br>

<br>

## 조인(JOIN)

### JOIN이란?

- 둘 이상의 테이블에서 데이터를 조회하기 위해서 사용
- 일반적으로 조인조건은 PK(Primary Key) 및 FK(Foreign Key)로 구성된다
- PK 및 FK 관계가 없더라도 논리적인 연관만으로도 JOIN이 가능하다
- JOIN의 종류
    - INNER JOIN : 조인 조건에 해당하는 칼럼 값이 양쪽테이블에 모두 존재하는 경우에만 조회, 동등 조인 (Equi-join)이라도고 한다. N개의 테이블 조인 시 N-1개의 조인 조건이 필요
    - OUTER JOIN : 조인 조건에 해당하는 칼럼 값이 한 쪽 테이블에만 존재하더라도 조회 기준 테이블에 따라 `LEFT OUTER JOIN` `RIGTH OUTER JOIN` 으로 구분

<br>

<br>
<br>

## 서브 쿼리(subQuery)

### 서브쿼리란?

- 하나의 SQL문 안에 포함되어 있는 SQL문을 의미한다
- 서브 쿼리를 포함하는 SQL을 외부 쿼리(outer query)또는 메인 쿼리라고 부르며 서브 쿼리는 내부 쿼리(inner query) 라고 부른다

<br>

<br>

### 서브 쿼리의 종류

- 중첩 서브 쿼리(Nested Subquery) - WHERE 절에 작성하는 서브쿼리
    - 단일-행, 다중-행, 다중-열
- 인라인 뷰(Inline-view) - FROM 절에 작성하는 서브쿼리
- 스칼라 서브 쿼리(Scalar Subquery) - SELECT 문에 작성하는 서브쿼리

<br>

<br>

<br>

## JDBC (Java DataBase Connectivity)

### JDBC 이용하여 DB연결하는 방법 4단계

1. JDBC 드라이버 로드
2. 데이터베이스 연결
3. SQL문 실행
4. 데이터베이스 연결 끊음

<br>

<br>

### JDBC 드라이버 로드

- DB와 연결하기 위해서는 사용할  JDBC 드라이버를 프로그램 시작할 때 로딩
- 필요한 DMBS의 jar 파일을 프로젝트에 추가한다
- java.lang.Class 클래스의 정적 메소드 `forName()` 을 이용하여 JVM 안으로 클래스를 메모리에 적재
- DriverManager을 통해 접근 가능

<br>

<br>

### DB별 Driver Class

- MySQL : com.mysql.cj.jdbc.Driver
- Oracle : oracle.jdbc.driver.OracleDriver
- SQL Server : com.Microsoft.sqlserver.jsdbc.SQLServerDriver

<br>
<br>

### 데이터베이스 연결

- DriverManager 클래스의 static 메소드인 getConnection (URL, UserId, UserPassword)를 통해 연결 요청
- Connection conn = DriverMagaer.getConnection(”URL”, “ssafy”, “ssfay”);
- Connection은 인터페이스이므로 new 연산자를 통해 인스턴스를 생성하지 않고 만들어진 인스턴스를 얻어와 저장한다.(default는 AutoCommit)

<br>
<br>

### SQL 실행 (Statement)

- SQL문을 수행하기 위해서는 Statement 객체가 필요하다
- Connectin 객체를 이용하여 `createStatement()` 메소드를 통해 생성한다
- `executeQuery(String sql)` : SELECT 문과 같이 결과값이 여러 개의 레코드로 구해지는 경우 사용
- `executeUpdate(Stringsql)` : INSERT, UPDATE, DELETE 문과 같이 테이블이 변경만 되고 결과가 없는 경우 사용 반환 값은 int 형

<br>

<br>

### SQL 실행 (ResultSet)

- Query에 대한 결과 값 처리
- 반환 값이 여러 개인 경우에 이를 받아서 쉽게 처리할 수 있게 설계됨
- `next()` 를 통해 현재 행에서 다음행으로 커서 이동
- `previous()` 를 통해 현재 행에서 이전 행으로 커서 이동
- `get XXX(Column Name/index)` 를 통해 값을 가져올 수 있음

<br>

<br>

### SQL 실행(PreparedStatement)

- Statement의 단점을 극복한 인터페이스
- 간단하게 쿼리문을 작성할 수 있도록 도움을 줌
- Connection 인터페이스의 prepareStatement(String sql) 메서드를 통해 가져옴
- `executeQuery()` /  `executeUpdate()` 사용
- SQL문은 ? 기호를 사용해서 표현 가능 [”INSERT INTO member VALUES(?, ?, ?, ?)”;]
- ? 기호에 값을 setXXX(int 순서 / 실제 데이터나 변수)를 통해 할당해야 함.

<br>

<br>

### 데이터베이스 연결 끊음

- 모든 작업이 끝나면 ResultSet, Statement(or PreparedStatement), Connection의 close()를 통해 연결을 종료한다. (역순으로 종료)